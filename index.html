<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Космос Gurren Lagann</title>
    <style>
        body {
            margin: 0;
            overflow-x: hidden;
            overflow-y: scroll;
            background: #000;
        }
        #container {
            width: 100vw;
            height: 1000vh; /* 10x высота экрана */
            position: relative;
        }
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            display: block;
        }
    </style>
</head>
<body>
<div id="container"></div>
<canvas id="space"></canvas>
<script>
    // ========================================
    // КОНФИГУРАЦИЯ
    // ========================================
    const CONFIG = {
        // Общие настройки
        contentHeightMultiplier: 10, // Во сколько раз контент больше высоты экрана

        // Настройки фоновых звезд
        stars: {
            count: 800,
            maxSize: 2,
            brightnessSpeed: 0.02
        },

        // Настройки галактик
        galaxies: {
            total: 25, // Общее количество галактик
            aroundMain: 14, // Количество галактик вокруг главной (внизу)

            // Расстояния от центра для галактик вокруг главной
            distance: {
                min: 150,
                maxMultiplier: 0.8 // Умножается на гипотенузу
            },

            // Скорость внутреннего вращения
            rotationSpeed: { min: 0.002, max: 0.005 },

            // 3D искажения (scale)
            mainScale: {
                x: 1,
                y: { min: 0.4, max: 1.0 }
            },
            otherScale: {
                x: { min: 0.4, max: 1.0 },
                y: { min: 0.3, max: 1.0 }
            },

            // Цвета (RGB каналы)
            color: { min: 100, max: 255 },

            // Разброс дополнительных галактик по контенту
            scatteredPosition: { min: 0.3, max: 0.8 }, // От 30% до 80% высоты

            // Свечение галактик
            glow: {
                coreSize: 0.1, // Размер ядра относительно размера галактики
                outerSize: 0.6, // Размер внешнего свечения относительно размера
                outerIntensity: 0.1 // Интенсивность внешнего свечения
            },

            // Настройки центральной (главной) галактики
            mainGalaxy: {
                size: { min: 1200, max: 2000 }, // Размеры (будут умножены на screenWidthFactor)
                stars: {
                    count: { min: 200, max: 800 }, // Больше звезд
                    arms: { min: 2, max: 6 }, // Больше рукавов
                    maxSize: { min: 1.0, max: 3 }, // Крупнее звезды
                    brightness: { min: 1.3, max: 1.6 }, // Ярче
                    brightnessSpeed: { min: 0.003, max: 0.01 },
                    clusterOffset: { min: 0.1, max: 0.8 },
                    densityPower: { min: 1.0, max: 5.0 } // Плотнее к центру
                }
            },

            // Настройки обычных галактик
            regularGalaxy: {
                size: { min: 250, max: 400 }, // Размеры (будут умножены на screenWidthFactor)
                stars: {
                    count: { min: 120, max: 180 },
                    arms: { min: 2, max: 6 },
                    maxSize: { min: 2.0, max: 3.0 },
                    brightness: { min: 1.0, max: 1.4 },
                    brightnessSpeed: { min: 0.005, max: 0.015 },
                    clusterOffset: { min: 0.3, max: 0.5 },
                    densityPower: { min: 2.5, max: 3.5 }
                }
            }
        }
    };
    // ========================================

    const canvas = document.getElementById('space');
    const ctx = canvas.getContext('2d');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    // Фоновые звезды - распределены по всей высоте контента
    const stars = [];
    const totalContentHeight = window.innerHeight * CONFIG.contentHeightMultiplier;

    for (let i = 0; i < CONFIG.stars.count; i++) {
        const scrollPosition = Math.random();
        stars.push({
            x: Math.random() * canvas.width,
            contentY: scrollPosition * totalContentHeight,
            size: Math.random() * CONFIG.stars.maxSize,
            brightness: Math.random(),
            speed: Math.random() * CONFIG.stars.brightnessSpeed,
            density: 1 - scrollPosition // Инвертируем: вверху плотнее, внизу меньше
        });
    }

    // Галактики с расположением от центра ВВЕРХУ контента
    const galaxies = [];

    const centerX = canvas.width / 2;
    const galaxyCenterY = canvas.height / 2; // Центр ВВЕРХУ контента
    const minDistance = CONFIG.galaxies.distance.min;
    const maxDistance = Math.sqrt(Math.pow(canvas.width / 2, 2) + Math.pow(canvas.height / 2, 2)) * CONFIG.galaxies.distance.maxMultiplier;

    // Базовые размеры галактик зависят от ширины экрана
    const screenWidthFactor = canvas.width / 1920;
    const mainGalaxySize = (CONFIG.galaxies.mainGalaxy.size.min + Math.random() * (CONFIG.galaxies.mainGalaxy.size.max - CONFIG.galaxies.mainGalaxy.size.min)) * screenWidthFactor;
    const otherGalaxyMinSize = CONFIG.galaxies.regularGalaxy.size.min * screenWidthFactor;
    const otherGalaxyMaxSize = CONFIG.galaxies.regularGalaxy.size.max * screenWidthFactor;

    // Генерируем полностью случайные параметры для каждой галактики
    for (let i = 0; i < CONFIG.galaxies.total; i++) {
        const size = i === 0 ? mainGalaxySize : otherGalaxyMinSize + Math.random() * (otherGalaxyMaxSize - otherGalaxyMinSize);
        const color = [
            Math.floor(CONFIG.galaxies.color.min + Math.random() * (CONFIG.galaxies.color.max - CONFIG.galaxies.color.min)),
            Math.floor(CONFIG.galaxies.color.min + Math.random() * (CONFIG.galaxies.color.max - CONFIG.galaxies.color.min)),
            Math.floor(CONFIG.galaxies.color.min + Math.random() * (CONFIG.galaxies.color.max - CONFIG.galaxies.color.min))
        ];
        const speed = CONFIG.galaxies.rotationSpeed.min + Math.random() * (CONFIG.galaxies.rotationSpeed.max - CONFIG.galaxies.rotationSpeed.min);
        const scaleX = i === 0 ? CONFIG.galaxies.mainScale.x : CONFIG.galaxies.otherScale.x.min + Math.random() * (CONFIG.galaxies.otherScale.x.max - CONFIG.galaxies.otherScale.x.min);
        const scaleY = i === 0 ? CONFIG.galaxies.mainScale.y.min + Math.random() * (CONFIG.galaxies.mainScale.y.max - CONFIG.galaxies.mainScale.y.min) : CONFIG.galaxies.otherScale.y.min + Math.random() * (CONFIG.galaxies.otherScale.y.max - CONFIG.galaxies.otherScale.y.min);
        const rotationZ = i === 0 ? 0 : Math.random() * Math.PI * 2;

        if (i === 0) {
            // Главная галактика вверху
            galaxies.push({
                x: centerX,
                contentY: galaxyCenterY,
                size: size,
                color: color,
                speed: speed,
                scaleX: scaleX,
                scaleY: scaleY,
                rotationZ: rotationZ,
                internalRotation: 0
            });
        } else if (i <= CONFIG.galaxies.aroundMain) {
            // Галактики вокруг главной (вверху)
            const angleStep = (Math.PI * 2) / CONFIG.galaxies.aroundMain;
            const baseAngle = angleStep * (i - 1);
            const angleVariation = (Math.random() - 0.5) * angleStep * 0.5;
            const angle = baseAngle + angleVariation;
            const distance = minDistance + Math.random() * (maxDistance - minDistance);

            const x = centerX + Math.cos(angle) * distance;
            const contentY = galaxyCenterY + Math.sin(angle) * distance;

            galaxies.push({
                x: x,
                contentY: contentY,
                size: size,
                color: color,
                speed: speed,
                scaleX: scaleX,
                scaleY: scaleY,
                rotationZ: rotationZ,
                internalRotation: 0
            });
        } else {
            // Дополнительные галактики разбросаны по пути (от верха вниз)
            const scrollPosition = CONFIG.galaxies.scatteredPosition.min + Math.random() * (CONFIG.galaxies.scatteredPosition.max - CONFIG.galaxies.scatteredPosition.min);
            const x = Math.random() * canvas.width;
            const contentY = scrollPosition * totalContentHeight;

            galaxies.push({
                x: x,
                contentY: contentY,
                size: size,
                color: color,
                speed: speed,
                scaleX: scaleX,
                scaleY: scaleY,
                rotationZ: rotationZ,
                internalRotation: 0
            });
        }
    }

    // Создаем звезды для каждой галактики
    galaxies.forEach((galaxy, index) => {
        galaxy.stars = [];

        // Выбираем конфиг в зависимости от типа галактики
        const starsConfig = index === 0 ? CONFIG.galaxies.mainGalaxy.stars : CONFIG.galaxies.regularGalaxy.stars;

        // Рандомизируем параметры для каждой галактики
        const arms = Math.floor(starsConfig.arms.min + Math.random() * (starsConfig.arms.max - starsConfig.arms.min + 1));
        const starsPerArm = Math.floor(starsConfig.count.min + Math.random() * (starsConfig.count.max - starsConfig.count.min + 1));
        const maxSize = starsConfig.maxSize.min + Math.random() * (starsConfig.maxSize.max - starsConfig.maxSize.min);
        const brightness = starsConfig.brightness.min + Math.random() * (starsConfig.brightness.max - starsConfig.brightness.min);
        const clusterOffset = starsConfig.clusterOffset.min + Math.random() * (starsConfig.clusterOffset.max - starsConfig.clusterOffset.min);
        const densityPower = starsConfig.densityPower.min + Math.random() * (starsConfig.densityPower.max - starsConfig.densityPower.min);

        // Сохраняем параметры в галактике
        galaxy.brightness = brightness;

        for (let arm = 0; arm < arms; arm++) {
            const armAngle = (Math.PI * 2 / arms) * arm;

            for (let i = 0; i < starsPerArm; i++) {
                const distance = (i / starsPerArm) * galaxy.size;
                const baseAngle = armAngle + (i / starsPerArm) * Math.PI * 4;

                const normalizedDistance = distance / galaxy.size;
                const density = Math.pow(1 - normalizedDistance, densityPower);

                const size = Math.random() * maxSize * density;
                const variation = Math.random() * 50 - 25;

                const offset = (Math.random() - 0.5) * clusterOffset * distance;

                galaxy.stars.push({
                    distance: distance,
                    baseAngle: baseAngle,
                    clusterOffset: offset,
                    size: size,
                    r: Math.max(0, Math.min(255, galaxy.color[0] + variation)),
                    g: Math.max(0, Math.min(255, galaxy.color[1] + variation)),
                    b: Math.max(0, Math.min(255, galaxy.color[2] + variation)),
                    brightness: Math.random(),
                    brightnessSpeed: (Math.random() * (starsConfig.brightnessSpeed.max - starsConfig.brightnessSpeed.min) + starsConfig.brightnessSpeed.min) * (Math.random() > 0.5 ? 1 : -1),
                    baseDensity: density
                });
            }
        }
    });

    function drawStars(scrollY) {
        const scrollProgress = scrollY / (totalContentHeight - canvas.height); // 0-1

        stars.forEach(star => {
            // Вычисляем экранную позицию звезды
            const screenY = star.contentY - scrollY;

            // Проверяем, видна ли звезда на экране
            if (screenY < -50 || screenY > canvas.height + 50) return;

            // Плотность и видимость зависят от прогресса скролла (инвертировано)
            const visibilityEnd = 1 - star.density * 0.7; // Звезды исчезают при скролле вниз
            if (scrollProgress > visibilityEnd) return;

            const visibilityProgress = Math.min(1, 1 - (scrollProgress - (visibilityEnd - 0.3)) / 0.3);

            star.brightness += star.speed;
            if (star.brightness > 1 || star.brightness < 0) star.speed *= -1;

            const finalOpacity = star.brightness * Math.max(0, visibilityProgress);

            ctx.fillStyle = `rgba(255, 255, 255, ${finalOpacity})`;
            ctx.beginPath();
            ctx.arc(star.x, screenY, star.size, 0, Math.PI * 2);
            ctx.fill();

            if (star.brightness > 0.7) {
                ctx.fillStyle = `rgba(255, 255, 255, ${(star.brightness - 0.7) * 0.5 * Math.max(0, visibilityProgress)})`;
                ctx.beginPath();
                ctx.arc(star.x, screenY, star.size * 2, 0, Math.PI * 2);
                ctx.fill();
            }
        });
    }

    function drawGalaxy(galaxy, scrollY) {
        const screenY = galaxy.contentY - scrollY;

        // Проверяем, видна ли галактика на экране (с запасом)
        if (screenY < -galaxy.size * 2 || screenY > canvas.height + galaxy.size * 2) return;

        const { x, size, color, scaleX, scaleY, rotationZ, internalRotation } = galaxy;

        // Плавное исчезновение галактики при скролле вниз
        const scrollProgress = scrollY / (totalContentHeight - canvas.height);
        const galaxyDisappearEnd = (galaxy.contentY / totalContentHeight) + 0.2;
        if (scrollProgress > galaxyDisappearEnd) return;

        const appearProgress = Math.min(1, 1 - Math.max(0, (scrollProgress - (galaxyDisappearEnd - 0.2)) / 0.2));

        ctx.save();
        ctx.globalAlpha = appearProgress;
        ctx.translate(x, screenY);
        ctx.rotate(rotationZ);
        ctx.scale(scaleX, scaleY);

        // Центральное ядро
        const coreGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, size * 0.3);
        coreGradient.addColorStop(0, `rgba(255, 255, 255, 1)`);
        coreGradient.addColorStop(0.3, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0.9)`);
        coreGradient.addColorStop(1, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0)`);

        ctx.fillStyle = coreGradient;
        ctx.beginPath();
        ctx.arc(0, 0, size * 0.3, 0, Math.PI * 2);
        ctx.fill();

        // Рисуем звезды
        galaxy.stars.forEach(star => {
            star.brightness += star.brightnessSpeed;
            if (star.brightness > 1) {
                star.brightness = 1;
                star.brightnessSpeed *= -1;
            } else if (star.brightness < 0.3) {
                star.brightness = 0.3;
                star.brightnessSpeed *= -1;
            }

            const currentAngle = star.baseAngle + internalRotation;
            const perpAngle = currentAngle + Math.PI / 2;
            const offsetX = Math.cos(perpAngle) * star.clusterOffset;
            const offsetY = Math.sin(perpAngle) * star.clusterOffset;

            const starX = Math.cos(currentAngle) * star.distance + offsetX;
            const starY = Math.sin(currentAngle) * star.distance + offsetY;

            const opacity = star.baseDensity * galaxy.brightness * star.brightness;

            ctx.fillStyle = `rgba(${star.r}, ${star.g}, ${star.b}, ${opacity})`;
            ctx.beginPath();
            ctx.arc(starX, starY, star.size, 0, Math.PI * 2);
            ctx.fill();

            if (opacity > 0.5) {
                ctx.fillStyle = `rgba(${star.r}, ${star.g}, ${star.b}, ${opacity * 0.3})`;
                ctx.beginPath();
                ctx.arc(starX, starY, star.size * 3, 0, Math.PI * 2);
                ctx.fill();
            }
        });

        // Внешнее свечение
        const outerGlow = ctx.createRadialGradient(0, 0, size * 0.7, 0, 0, size * CONFIG.galaxies.glow.outerSize);
        outerGlow.addColorStop(0, `rgba(${color[0]}, ${color[1]}, ${color[2]}, ${CONFIG.galaxies.glow.outerIntensity})`);
        outerGlow.addColorStop(1, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0)`);

        ctx.fillStyle = outerGlow;
        ctx.beginPath();
        ctx.arc(0, 0, size * CONFIG.galaxies.glow.outerSize, 0, Math.PI * 2);
        ctx.fill();

        ctx.restore();
    }

    function animate() {
        const scrollY = window.scrollY;
        const scrollProgress = scrollY / (totalContentHeight - canvas.height);

        // Темный фон
        const bgGradient = ctx.createRadialGradient(
            canvas.width / 2, canvas.height / 2, 0,
            canvas.width / 2, canvas.height / 2, canvas.width
        );
        bgGradient.addColorStop(0, '#0a0520');
        bgGradient.addColorStop(1, '#000000');
        ctx.fillStyle = bgGradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Рисуем звезды
        drawStars(scrollY);

        // Рисуем и вращаем галактики
        galaxies.forEach(galaxy => {
            galaxy.internalRotation += galaxy.speed;
            drawGalaxy(galaxy, scrollY);
        });

        requestAnimationFrame(animate);
    }

    // Автоматический скролл вниз при загрузке страницы
    window.addEventListener('load', () => {
        window.scrollTo(0, document.body.scrollHeight);
        animate();
    });
</script>
</body>
</html>