<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Глебушке</title>
    <style>
        body {
            margin: 0;
            overflow-x: hidden;
            overflow-y: scroll;
            background: #000;
        }
        #container {
            width: 100vw;
            height: 1000vh; /* 10x высота экрана */
            position: relative;
        }
        canvas {
            position: fixed;
            top: 0;
            left: 0;
            display: block;
        }
    </style>
</head>
<body>
<div id="container"></div>
<canvas id="space"></canvas>
<script>
    const canvas = document.getElementById('space');
    const ctx = canvas.getContext('2d');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    // Фоновые звезды - распределены по всей высоте контента
    const stars = [];
    const totalContentHeight = window.innerHeight * 10;

    for (let i = 0; i < 800; i++) {
        const scrollPosition = Math.random(); // 0-1, где 1 = низ контента
        stars.push({
            x: Math.random() * canvas.width,
            contentY: scrollPosition * totalContentHeight, // Позиция в контенте
            size: Math.random() * 2,
            brightness: Math.random(),
            speed: Math.random() * 0.02,
            density: scrollPosition // Плотность зависит от позиции (ниже = плотнее)
        });
    }

    // Галактики с расположением от центра внизу контента
    const galaxies = [];
    const numGalaxies = 25; // Увеличено количество галактик

    const centerX = canvas.width / 2;
    const galaxyCenterY = totalContentHeight - canvas.height / 2; // Центр внизу контента
    const minDistance = 150;
    const maxDistance = Math.sqrt(Math.pow(canvas.width / 2, 2) + Math.pow(canvas.height / 2, 2)) * 0.8;

    // Базовый размер зависит от ширины экрана
    const screenSizeFactor = (canvas.width / 1920) * 3; // Увеличен коэффициент в 3 раза (2 * 1.5)

    // Генерируем полностью случайные параметры для каждой галактики
    for (let i = 0; i < numGalaxies; i++) {
        const baseSize = i === 0 ? 300 + Math.random() * 100 : 60 + Math.random() * 90;
        const size = baseSize * screenSizeFactor; // Размер зависит от ширины экрана
        const color = [
            Math.floor(100 + Math.random() * 155),
            Math.floor(100 + Math.random() * 155),
            Math.floor(100 + Math.random() * 155)
        ];
        const speed = 0.002 + Math.random() * 0.003;
        const scaleX = i === 0 ? 1 : 0.4 + Math.random() * 0.6;
        const scaleY = i === 0 ? 0.4 + Math.random() * 0.6 : 0.3 + Math.random() * 0.7;
        const rotationZ = i === 0 ? 0 : Math.random() * Math.PI * 2;

        if (i === 0) {
            // Главная галактика внизу
            galaxies.push({
                x: centerX,
                contentY: galaxyCenterY,
                size: size,
                color: color,
                speed: speed,
                scaleX: scaleX,
                scaleY: scaleY,
                rotationZ: rotationZ,
                internalRotation: 0
            });
        } else if (i <= 14) {
            // Галактики вокруг главной (внизу)
            const numOtherGalaxies = 14;
            const angleStep = (Math.PI * 2) / numOtherGalaxies;
            const baseAngle = angleStep * (i - 1);
            const angleVariation = (Math.random() - 0.5) * angleStep * 0.5;
            const angle = baseAngle + angleVariation;
            const distance = minDistance + Math.random() * (maxDistance - minDistance);

            const x = centerX + Math.cos(angle) * distance;
            const contentY = galaxyCenterY + Math.sin(angle) * distance;

            galaxies.push({
                x: x,
                contentY: contentY,
                size: size,
                color: color,
                speed: speed,
                scaleX: scaleX,
                scaleY: scaleY,
                rotationZ: rotationZ,
                internalRotation: 0
            });
        } else {
            // Дополнительные галактики разбросаны по пути
            const scrollPosition = 0.3 + Math.random() * 0.5; // Распределены от 30% до 80% высоты контента
            const x = Math.random() * canvas.width;
            const contentY = scrollPosition * totalContentHeight;

            galaxies.push({
                x: x,
                contentY: contentY,
                size: size,
                color: color,
                speed: speed,
                scaleX: scaleX,
                scaleY: scaleY,
                rotationZ: rotationZ,
                internalRotation: 0
            });
        }
    }

    // Создаем звезды для каждой галактики
    galaxies.forEach(galaxy => {
        galaxy.stars = [];
        const arms = 3;

        for (let arm = 0; arm < arms; arm++) {
            const armAngle = (Math.PI * 2 / arms) * arm;

            for (let i = 0; i < 150; i++) {
                const distance = (i / 150) * galaxy.size;
                const baseAngle = armAngle + (i / 150) * Math.PI * 4;

                const normalizedDistance = distance / galaxy.size;
                const density = Math.pow(1 - normalizedDistance, 3);

                const size = Math.random() * 2.5 * density;
                const variation = Math.random() * 50 - 25;

                const clusterOffset = (Math.random() - 0.5) * 0.4 * distance;

                galaxy.stars.push({
                    distance: distance,
                    baseAngle: baseAngle,
                    clusterOffset: clusterOffset,
                    size: size,
                    r: Math.max(0, Math.min(255, galaxy.color[0] + variation)),
                    g: Math.max(0, Math.min(255, galaxy.color[1] + variation)),
                    b: Math.max(0, Math.min(255, galaxy.color[2] + variation)),
                    brightness: Math.random(),
                    brightnessSpeed: (Math.random() * 0.01 + 0.005) * (Math.random() > 0.5 ? 1 : -1),
                    baseDensity: density
                });
            }
        }
    });

    function drawStars(scrollY) {
        const scrollProgress = scrollY / (totalContentHeight - canvas.height); // 0-1

        stars.forEach(star => {
            // Вычисляем экранную позицию звезды
            const screenY = star.contentY - scrollY;

            // Проверяем, видна ли звезда на экране
            if (screenY < -50 || screenY > canvas.height + 50) return;

            // Плотность и видимость зависят от прогресса скролла
            const visibilityStart = star.density * 0.7; // Звезды начинают появляться
            if (scrollProgress < visibilityStart) return;

            const visibilityProgress = Math.min(1, (scrollProgress - visibilityStart) / 0.3);

            star.brightness += star.speed;
            if (star.brightness > 1 || star.brightness < 0) star.speed *= -1;

            const finalOpacity = star.brightness * visibilityProgress;

            ctx.fillStyle = `rgba(255, 255, 255, ${finalOpacity})`;
            ctx.beginPath();
            ctx.arc(star.x, screenY, star.size, 0, Math.PI * 2);
            ctx.fill();

            if (star.brightness > 0.7) {
                ctx.fillStyle = `rgba(255, 255, 255, ${(star.brightness - 0.7) * 0.5 * visibilityProgress})`;
                ctx.beginPath();
                ctx.arc(star.x, screenY, star.size * 2, 0, Math.PI * 2);
                ctx.fill();
            }
        });
    }

    function drawGalaxy(galaxy, scrollY) {
        const screenY = galaxy.contentY - scrollY;

        // Проверяем, видна ли галактика на экране (с запасом)
        if (screenY < -galaxy.size * 2 || screenY > canvas.height + galaxy.size * 2) return;

        const { x, size, color, scaleX, scaleY, rotationZ, internalRotation } = galaxy;

        // Плавное появление галактики
        const scrollProgress = scrollY / (totalContentHeight - canvas.height);
        const galaxyAppearStart = (galaxy.contentY / totalContentHeight) - 0.2;
        if (scrollProgress < galaxyAppearStart) return;

        const appearProgress = Math.min(1, (scrollProgress - galaxyAppearStart) / 0.2);

        ctx.save();
        ctx.globalAlpha = appearProgress;
        ctx.translate(x, screenY);
        ctx.rotate(rotationZ);
        ctx.scale(scaleX, scaleY);

        // Центральное ядро
        const coreGradient = ctx.createRadialGradient(0, 0, 0, 0, 0, size * 0.3);
        coreGradient.addColorStop(0, `rgba(255, 255, 255, 1)`);
        coreGradient.addColorStop(0.3, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0.9)`);
        coreGradient.addColorStop(1, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0)`);

        ctx.fillStyle = coreGradient;
        ctx.beginPath();
        ctx.arc(0, 0, size * 0.3, 0, Math.PI * 2);
        ctx.fill();

        // Рисуем звезды
        galaxy.stars.forEach(star => {
            star.brightness += star.brightnessSpeed;
            if (star.brightness > 1) {
                star.brightness = 1;
                star.brightnessSpeed *= -1;
            } else if (star.brightness < 0.3) {
                star.brightness = 0.3;
                star.brightnessSpeed *= -1;
            }

            const currentAngle = star.baseAngle + internalRotation;
            const perpAngle = currentAngle + Math.PI / 2;
            const offsetX = Math.cos(perpAngle) * star.clusterOffset;
            const offsetY = Math.sin(perpAngle) * star.clusterOffset;

            const starX = Math.cos(currentAngle) * star.distance + offsetX;
            const starY = Math.sin(currentAngle) * star.distance + offsetY;

            const opacity = star.baseDensity * 1.2 * star.brightness;

            ctx.fillStyle = `rgba(${star.r}, ${star.g}, ${star.b}, ${opacity})`;
            ctx.beginPath();
            ctx.arc(starX, starY, star.size, 0, Math.PI * 2);
            ctx.fill();

            if (opacity > 0.5) {
                ctx.fillStyle = `rgba(${star.r}, ${star.g}, ${star.b}, ${opacity * 0.3})`;
                ctx.beginPath();
                ctx.arc(starX, starY, star.size * 3, 0, Math.PI * 2);
                ctx.fill();
            }
        });

        // Внешнее свечение
        const outerGlow = ctx.createRadialGradient(0, 0, size * 0.7, 0, 0, size);
        outerGlow.addColorStop(0, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0.3)`);
        outerGlow.addColorStop(1, `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0)`);

        ctx.fillStyle = outerGlow;
        ctx.beginPath();
        ctx.arc(0, 0, size, 0, Math.PI * 2);
        ctx.fill();

        ctx.restore();
    }

    function animate() {
        const scrollY = window.scrollY;
        const scrollProgress = scrollY / (totalContentHeight - canvas.height);

        // Темный фон
        const bgGradient = ctx.createRadialGradient(
            canvas.width / 2, canvas.height / 2, 0,
            canvas.width / 2, canvas.height / 2, canvas.width
        );
        bgGradient.addColorStop(0, '#0a0520');
        bgGradient.addColorStop(1, '#000000');
        ctx.fillStyle = bgGradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Рисуем звезды
        drawStars(scrollY);

        // Рисуем и вращаем галактики
        galaxies.forEach(galaxy => {
            galaxy.internalRotation += galaxy.speed;
            drawGalaxy(galaxy, scrollY);
        });

        requestAnimationFrame(animate);
    }

    animate();
</script>
</body>
</html>